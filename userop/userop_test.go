package userop

import (
	"fmt"
	"testing"

	"encoding/json"

	"github.com/ethereum/go-ethereum/common"
)

func TestPack(t *testing.T) {
	var a uint64 = 4000000
	var b uint64 = 200000
	bt := PackUints(a, b)
	fmt.Printf("bt: %x | %x\n", bt[0:16], bt[16:])
	fmt.Println(UnpackUints(bt))
}

/*
sender: '0x63D993703e0514bE8C693D6CC91362A79B92Ce82',

	nonce: 0,
	initCode: '0x',
	callData: '0xb61d27f6000000000000000000000000754925c070c5368ae28d1d552dedae302280336d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000084cadcff3b0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000e6c8fe3ad93f726543689c94864ea0a45e3a7b680000000000000000000000000000000000000000000000000000000000000002613300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
	callGasLimit: 4000000,
	verificationGasLimit: 200000,
	preVerificationGas: 20000,
	maxFeePerGas: 1000,
	maxPriorityFeePerGas: 1000000,
	paymaster: '0x0000000000000000000000000000000000000000',
	paymasterData: '0x',
	paymasterVerificationGasLimit: 0,
	paymasterPostOpGasLimit: 0,
	signature: '0x7b7b8b69b6c2746006c84e6afe5a0470e2c31e2344721a91e8a8483725ab8efe5c10e7e46b56fb5092001e9e5b7070112e6bfa64b87d4ca994af5da3c71f39a71c'
*/
var TestUserOp UserOp

func init() {
	sender := common.HexToAddress("0x63D993703e0514bE8C693D6CC91362A79B92Ce82")
	TestUserOp = UserOp{
		Sender:                        &sender,
		Nonce:                         0,
		CallData:                      common.Hex2Bytes("b61d27f6000000000000000000000000754925c070c5368ae28d1d552dedae302280336d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000084cadcff3b0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000e6c8fe3ad93f726543689c94864ea0a45e3a7b680000000000000000000000000000000000000000000000000000000000000002613300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
		CallGasLimit:                  4000000,
		VerificationGasLimit:          200000,
		PreVerificationGas:            20000,
		MaxFeePerGas:                  1000,
		MaxPriorityFeePerGas:          1000000,
		Paymaster:                     nil,
		PaymasterData:                 []byte{},
		PaymasterVerificationGasLimit: 0,
		PaymasterPostOpGasLimit:       0,
		Signature:                     common.Hex2Bytes("7b7b8b69b6c2746006c84e6afe5a0470e2c31e2344721a91e8a8483725ab8efe5c10e7e46b56fb5092001e9e5b7070112e6bfa64b87d4ca994af5da3c71f39a71c"),
	}
}

func TestPackUserOp(t *testing.T) {
	uop := TestUserOp
	puop := uop.Pack()
	bt, err := json.MarshalIndent(puop, "", "  ")
	if err != nil {
		t.Error(err)
	}

	fmt.Println(string(bt))

}
